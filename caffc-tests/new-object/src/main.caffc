module main

native {
#include <stdio.h>
}

class A {
  i32 index

  constructor(i32 index) {
    _this.index = index
  }

  hello(i32 index) {
    native {
      printf("hello world from object: %d, a is %d\n", index, _this->index);
      caffc_gc_perform();
    }

  }
}

main() {
  A a = new A(4)
  new A(3).hello(4)
}

native {
  int main(int argc, const char* argv[]) {
    atexit(caffc_done);
    caffc_init();

    main_main();

    return 0;
  }
}

